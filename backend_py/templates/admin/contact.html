{% extends "admin/base.html" %}

{% block content %}
<div class="row">

  <!-- LEFT -->
  <div class="col-lg-4 mb-4">
    <div class="card">
      <div class="card-header"><strong>N√∫t ƒëi·ªÅu h∆∞·ªõng</strong></div>
      <div class="card-body d-grid gap-2">
        <a href="https://shop.thanhtamtraquan.com" target="_blank" class="btn btn-outline-primary">
          üåê Website
        </a>
        <a href="https://dangkylich.thanhtamtraquan.com" target="_blank" class="btn btn-outline-success">
          üìÖ ƒêƒÉng k√Ω l·ªãch
        </a>
        <a href="https://kanban.thanhtamtraquan.com" target="_blank" class="btn btn-outline-dark">
          üìã Kanban
        </a>
      </div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="col-lg-8">

    <!-- ADDRESS -->
    <div class="card mb-3">
      <div class="card-header"><strong>Qu·∫£n l√Ω Address</strong></div>
      <div class="card-body">
        <textarea id="address-content" class="form-control" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ"></textarea>
        <button class="btn btn-success mt-2" onclick="addAddress()">Th√™m</button>
        <table class="table mt-3" id="tbl-address"></table>
      </div>
    </div>

    <!-- EMAIL -->
    <div class="card mb-3">
      <div class="card-header"><strong>Qu·∫£n l√Ω Email</strong></div>
      <div class="card-body">
        <input id="email-content" class="form-control" placeholder="Nh·∫≠p email">
        <button class="btn btn-success mt-2" onclick="addEmail()">Th√™m</button>
        <table class="table mt-3" id="tbl-email"></table>
      </div>
    </div>

    <!-- PHONE -->
    <div class="card">
      <div class="card-header"><strong>Qu·∫£n l√Ω Phone</strong></div>
      <div class="card-body">
        <input id="phone-content" class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
        <button class="btn btn-success mt-2" onclick="addPhone()">Th√™m</button>
        <table class="table mt-3" id="tbl-phone"></table>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    loadAddress();
    loadEmail();
    loadPhone();
  });

  // ================= fetch + render ADDRESS =================
  async function loadAddress() {
    const res = await fetch("/admin/address", { credentials: "same-origin" });
    const data = await res.json();
    const tbl = document.getElementById("tbl-address");

    tbl.innerHTML = `
      <tr>
        <th>#</th>
        <th>N·ªôi dung</th>
        <th>Tr·∫°ng th√°i</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    `;

    data.forEach((item, idx) => {
      tbl.innerHTML += `
        <tr>
          <td>${idx + 1}</td>
          <td>${item.noiDung}</td>
          <td>${item.trangThai}</td>
          <td>
            <button class="btn btn-sm btn-primary"
              onclick="editAddress(${item.id}, \`${item.noiDung}\`)">S·ª≠a</button>

            <button class="btn btn-sm btn-warning"
              onclick="toggleAddress(${item.id}, '${item.trangThai}')">
              ${item.trangThai === "ACTIVE" ? "·∫®n" : "Hi·ªán"}
            </button>
          </td>
        </tr>
      `;
    });
  }


  // ================= fetch + render EMAIL  =================
  async function loadEmail() {
    const res = await fetch("/admin/email", { credentials: "same-origin" });
    const data = await res.json();
    const tbl = document.getElementById("tbl-email");

    tbl.innerHTML = `
      <tr>
        <th>#</th>
        <th>Email</th>
        <th>Tr·∫°ng th√°i</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    `;

    data.forEach((item, idx) => {
      tbl.innerHTML += `
        <tr>
          <td>${idx + 1}</td>
          <td>${item.noiDung}</td>
          <td>${item.trangThai}</td>
          <td>
            <button class="btn btn-sm btn-primary"
              onclick="editEmail(${item.id}, '${item.noiDung}')">S·ª≠a</button>

            <button class="btn btn-sm btn-warning"
              onclick="toggleEmail(${item.id}, '${item.trangThai}')">
              ${item.trangThai === "ACTIVE" ? "·∫®n" : "Hi·ªán"}
            </button>
          </td>
        </tr>
      `;
    });
  }

  // ================= fetch + render PHONE OF Contact =================
  async function loadPhone() {
    const res = await fetch("/admin/phone", { credentials: "same-origin" });
    const data = await res.json();
    const tbl = document.getElementById("tbl-phone");

    tbl.innerHTML = `
      <tr>
        <th>#</th>
        <th>S·ªë ƒëi·ªán tho·∫°i</th>
        <th>Tr·∫°ng th√°i</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    `;

    data.forEach((item, idx) => {
      tbl.innerHTML += `
        <tr>
          <td>${idx + 1}</td>
          <td>${item.noiDung}</td>
          <td>${item.trangThai}</td>
          <td>
            <button class="btn btn-sm btn-primary"
              onclick="editPhone(${item.id}, '${item.noiDung}')">S·ª≠a</button>

            <button class="btn btn-sm btn-warning"
              onclick="togglePhone(${item.id}, '${item.trangThai}')">
              ${item.trangThai === "ACTIVE" ? "·∫®n" : "Hi·ªán"}
            </button>
          </td>
        </tr>
      `;
    });
  }

  // ---------- create Address _Contact ----------
  async function addAddress() {
    const textarea = document.getElementById("address-content");
    const noiDung = textarea.value.trim();

    if (!noiDung) {
      alert("Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ");
      return;
    }

    const res = await fetch("/admin/address", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "same-origin",
      body: JSON.stringify({ noiDung })
    });

    const data = await res.json();
    if (!res.ok) {
      alert(data.msg || "L·ªói th√™m address");
      return;
    }

    textarea.value = "";
    loadAddress();
  }

  async function toggleAddress(id, trangThai) {
    await fetch(`/admin/address/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      credentials: "same-origin",
      body: JSON.stringify({
        trangThai: trangThai === "ACTIVE" ? "HIDE" : "ACTIVE"
      })
    });

    loadAddress();
  }
  //==============================================


  // ---------- create Email _Contact ----------
  async function addEmail() {
    const input = document.getElementById("email-content");
    const noiDung = input.value.trim();

    if (!noiDung) {
      alert("Vui l√≤ng nh·∫≠p email");
      return;
    }

    const res = await fetch("/admin/email", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "same-origin",
      body: JSON.stringify({ noiDung })
    });

    const data = await res.json();
    if (!res.ok) {
      alert(data.msg || "L·ªói th√™m email");
      return;
    }

    input.value = "";
    loadEmail();
  }

  async function toggleEmail(id, trangThai) {
    await fetch(`/admin/email/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      credentials: "same-origin",
      body: JSON.stringify({
        trangThai: trangThai === "ACTIVE" ? "HIDE" : "ACTIVE"
      })
    });

    loadEmail();
  }
  //==============================================


  // ---------- create Phone _Contact ----------

  async function addPhone() {
    const input = document.getElementById("phone-content");
    const noiDung = input.value.trim();

    if (!noiDung) {
      alert("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i");
      return;
    }

    const res = await fetch("/admin/phone", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "same-origin",
      body: JSON.stringify({ noiDung })
    });

    const data = await res.json();
    if (!res.ok) {
      alert(data.msg || "L·ªói th√™m phone");
      return;
    }

    input.value = "";
    loadPhone();
  }

  async function togglePhone(id, trangThai) {
    await fetch(`/admin/phone/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      credentials: "same-origin",
      body: JSON.stringify({
        trangThai: trangThai === "ACTIVE" ? "HIDE" : "ACTIVE"
      })
    });

    loadPhone();
  }
  //==============================================


  // ---------- Edit address, email, phone _contact ----------

  async function editAddress(id, oldValue) {
    const noiDung = prompt("S·ª≠a ƒë·ªãa ch·ªâ:", oldValue);
    if (!noiDung || noiDung.trim() === oldValue) return;

    await fetch(`/admin/address/edit/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      credentials: "same-origin",
      body: JSON.stringify({ noiDung })
    });

    loadAddress();
  }

  async function editEmail(id, oldValue) {
    const noiDung = prompt("S·ª≠a email:", oldValue);
    if (!noiDung || noiDung.trim() === oldValue) return;

    await fetch(`/admin/email/edit/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      credentials: "same-origin",
      body: JSON.stringify({ noiDung })
    });

    loadEmail();
  }

  async function editPhone(id, oldValue) {
    const noiDung = prompt("S·ª≠a s·ªë ƒëi·ªán tho·∫°i:", oldValue);
    if (!noiDung || noiDung.trim() === oldValue) return;

    await fetch(`/admin/phone/edit/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      credentials: "same-origin",
      body: JSON.stringify({ noiDung })
    });

    loadPhone();
  }

  //==============================================
</script>
{% endblock %}